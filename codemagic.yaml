workflows:
  android-release:
    name: Android Release Build
    environment:
      groups:
        - keystore
      vars:
        JAVA_HOME: "/Users/builder/hostedtoolcache/Java_Temurin-Hotspot_jdk/11.0.23-8/x64/Contents/Home"  # Verified working path
    scripts:
      - name: Verify Java Installation
        script: |
          echo "=== Java Version ==="
          /usr/libexec/java_home -V  # List available Java versions
          java -version
          echo "JAVA_HOME=$JAVA_HOME"
          ls -la "$JAVA_HOME/bin/java" || echo "Java path verification failed"

      - name: Setup Build Environment
        script: |
          flutter clean
          rm -rf android/build
          flutter pub get

      - name: Run Gradle Build
        script: |
          cd android
          ./gradlew clean assembleRelease --stacktrace --info --scan
          cd ..

      - name: Collect Artifacts
        script: |
          mkdir -p build/outputs/apk
          cp build/app/outputs/flutter-apk/*.apk build/outputs/apk/
    artifacts:
      - build/outputs/apk/*.apk